<!DOCTYPE html>
<html><head>
<title>Modifying Openshifts CoreOS ignition files</title>

<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="Modify CoreOS ignition files to set static network configuration (ESXi On Packet pt2)">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">




<script src="/vendor/js/jquery.min.js" ></script>
<script src="/vendor/js/popper.min.js" ></script>
<script src="/vendor/js/bootstrap.min.js" ></script>
<script src="/vendor/js/smooth-scroll.polyfills.min.js" ></script>
<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">
<script src="/vendor/js/vue.min.js" ></script>




<link rel="stylesheet" href="https://sysadm.life/scss/journal.min.4d38eca5dcf257f3cae4bbdd96b43d752b28df8bb0d10e5b74683707cd1c600a.css"  media="screen">



<link rel="stylesheet" href="https://sysadm.life/scss/dark-mode.min.76f9487d767dd4077d2df791b15332feb4b8b20c376e6c23ba4b9be293511a23.css"  media="screen">


<script src="/js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Lora|Montserrat|Fira+Mono|Noto+Serif+SC|Material+Icons");
</script>

<script src="https://sysadm.life/js/table.js"></script>




<script src="https://sysadm.life/js/toc.js"></script>



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="/vendor/js/md5.min.js"></script>
<script>
  var gitalk = new Gitalk({
  clientID: 'your client id',
  clientSecret: 'your client secret',
  repo: 'repo name',
  owner: 'user',
  admin: ['user'],
  id: md5(location.pathname),
  distractionFreeMode: 'false'
  });
  window.onload = function () {
        gitalk.render('gitalk-container')
  }
</script>






</head>
<body>
    	<div id="app"><div ref="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://sysadm.life">
    
        <div class="nav-title">
            sysadm.life
        </div>
        
        <div class="nav-subtitle">
            Adventures of a consultant
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/posts">
                Archive
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about">
                About
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                Tags
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
    </div>
    
</div><div ref="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#high-level-overview" v-on:click="closeDrawer" id="high-level-overview-nav">
										 High Level Overview
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#networking" v-on:click="closeDrawer" id="networking-nav">
										 Networking
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
						
								<li>
				 					<a href="#setup-bastioninstaller-server" v-on:click="closeDrawer" id="setup-bastioninstaller-server-nav">
										 Setup Bastion/Installer server
									</a>
								</li>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#setup-dhcp" v-on:click="closeDrawer" id="setup-dhcp-nav">
										 Setup DHCP
									</a>
								</li>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#etcdhcpdhcpdconf" v-on:click="closeDrawer" id="etcdhcpdhcpdconf-nav">
										 /etc/dhcp/dhcpd.conf
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#start-dhcp" v-on:click="closeDrawer" id="start-dhcp-nav">
										 Start DHCP
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
						
								<li>
				 					<a href="#ignition" v-on:click="closeDrawer" id="ignition-nav">
										 Ignition
									</a>
								</li>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#fyi" v-on:click="closeDrawer" id="fyi-nav">
										 FYI
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#creating-new-modified-ignition-files" v-on:click="closeDrawer" id="creating-new-modified-ignition-files-nav">
										 Creating new modified Ignition files
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#post-modification" v-on:click="closeDrawer" id="post-modification-nav">
										 Post Modification
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
						
								<li>
				 					<a href="#openshift-install-process" v-on:click="closeDrawer" id="openshift-install-process-nav">
										 Openshift Install Process
									</a>
								</li>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#create-vms" v-on:click="closeDrawer" id="create-vms-nav">
										 Create VMs
									</a>
								</li>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
						
								<li>
				 					<a href="#summary" v-on:click="closeDrawer" id="summary-nav">
										 Summary
									</a>
								</li>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
						
								<li>
				 					<a href="#references" v-on:click="closeDrawer" id="references-nav">
										 References
									</a>
								</li>
						
							</ul>
						
					
				
			
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a class="pagination-action" v-on:click="toggleDarkMode">
            <i class="material-icons pagination-action-icon" v-if="isDarkMode">
                brightness_4
            </i>
            <i class="material-icons pagination-action-icon" v-else="isDarkMode">
                brightness_7
            </i>
        </a>
        
        
    </div>
</div><div class="single-column-drawer-container" ref="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/posts">
                    Archive
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about">
                    About
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    Tags
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#high-level-overview" v-on:click="closeDrawer" id="high-level-overview-nav">
										 High Level Overview
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#networking" v-on:click="closeDrawer" id="networking-nav">
										 Networking
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
						
								<li>
				 					<a href="#setup-bastioninstaller-server" v-on:click="closeDrawer" id="setup-bastioninstaller-server-nav">
										 Setup Bastion/Installer server
									</a>
								</li>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#setup-dhcp" v-on:click="closeDrawer" id="setup-dhcp-nav">
										 Setup DHCP
									</a>
								</li>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#etcdhcpdhcpdconf" v-on:click="closeDrawer" id="etcdhcpdhcpdconf-nav">
										 /etc/dhcp/dhcpd.conf
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#start-dhcp" v-on:click="closeDrawer" id="start-dhcp-nav">
										 Start DHCP
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
						
								<li>
				 					<a href="#ignition" v-on:click="closeDrawer" id="ignition-nav">
										 Ignition
									</a>
								</li>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#fyi" v-on:click="closeDrawer" id="fyi-nav">
										 FYI
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#creating-new-modified-ignition-files" v-on:click="closeDrawer" id="creating-new-modified-ignition-files-nav">
										 Creating new modified Ignition files
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#post-modification" v-on:click="closeDrawer" id="post-modification-nav">
										 Post Modification
									</a>
								</li>
						
							</ul>
						
							</ul>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
						
								<li>
				 					<a href="#openshift-install-process" v-on:click="closeDrawer" id="openshift-install-process-nav">
										 Openshift Install Process
									</a>
								</li>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
							<ul>
						
						
								<li>
				 					<a href="#create-vms" v-on:click="closeDrawer" id="create-vms-nav">
										 Create VMs
									</a>
								</li>
						
							</ul>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
						
								<li>
				 					<a href="#summary" v-on:click="closeDrawer" id="summary-nav">
										 Summary
									</a>
								</li>
						
							</ul>
						
					
				
			
				
				
					
						
						
							<ul>
						
						
								<li>
				 					<a href="#references" v-on:click="closeDrawer" id="references-nav">
										 References
									</a>
								</li>
						
							</ul>
						
					
				
			
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav ref="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div ref="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a ref="navTitle" class="navbar-brand" href="https://sysadm.life">
            sysadm.life
        </a>
        
        <button type="button" class="nav-darkmode-toggle" v-on:click="toggleDarkMode">
            <i class="material-icons" v-if="isDarkMode">
                brightness_4
            </i>
            <i class="material-icons" v-else="isDarkMode">
                brightness_7
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" ref="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://sysadm.life">
        <div class="single-column-header-title">sysadm.life</div>
        
        <div class="single-column-header-subtitle">Adventures of a consultant</div>
        

    </a>
</div>
            <div id="content">
<div ref="streamContainer" class="stream-container">
    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title">
                    Modifying Openshifts CoreOS ignition files
                    
                    <div class="post-subtitle">
                        Modify CoreOS ignition files to set static network configuration (ESXi On Packet pt2)
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            Mon, 22 Jun 2020
                        </time>
                        

                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/openshift">Openshift</a>
                                &nbsp;
                            
                                <a href="/tags/vmware">VMware</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>

            <div class="post-body-wrapper">
                <div class="post-body">
                    <p>This article was put together to help assist performing Openshift 4 deployments on VMWare ESXi where static IPs are required but where DHCP is available and is allowed to give out temporary addresses. Doing it this way as (opposed to my last article where DHCP was not used) allows us to use the ova templates and will not require the creation of any separate boot isos. This is possible as enabling DHCP will allow the machines that have been created with the just the OVAs to boot first using a random DHCP given IP. However, as we want a static addresses we can set what the network configuration will be by injecting this into the ignition files and once the machine has booted for the first time using DHCP it will then use the network configuration to what is defined in the ignition file going forward.</p>
<p>Like my last article, I performed and validated the steps below on ESXi hosted by Packet. I did not include all the steps (like my last article did); only the pertinent parts this time. If you follow my previous article up the the point of generating ignition files you should be able to follow the rest of the steps listed here.</p>
<h3 id="high-level-overview">High Level Overview</h3>
<ol>
<li>Install and setup DHCP server</li>
<li>Modify Ignition files</li>
<li>Create VMs</li>
</ol>
<h3 id="networking">Networking</h3>
<p>The network setup is the same as it was in the previous article. So I will not go into details here this time as the previous article can be referred to if necessary. For the DHCP element, we only care about addresses in our private range. If you don&rsquo;t want to flick back or read the last article, here&rsquo;s the network summary for our private addresses:</p>
<table>
<thead>
<tr>
<th>ADDRESS</th>
<th>NETWORK</th>
<th>GATEWAY</th>
<th>TYPE</th>
</tr>
</thead>
<tbody>
<tr>
<td>10.80.158.2</td>
<td>10.80.158.0/28</td>
<td>10.80.158.1</td>
<td>Private IPv4</td>
</tr>
</tbody>
</table>
<p>For our private network we have a CIDR of /28, so its netmask is 255.255.255.240.</p>
<table>
<thead>
<tr>
<th>ADDRESS</th>
<th>USEAGE</th>
</tr>
</thead>
<tbody>
<tr>
<td>10.80.158.0</td>
<td>Network</td>
</tr>
<tr>
<td>10.80.158.1</td>
<td>Gateway</td>
</tr>
<tr>
<td>10.80.158.2</td>
<td>ESXi</td>
</tr>
<tr>
<td>10.80.158.3</td>
<td>Available</td>
</tr>
<tr>
<td>10.80.158.4</td>
<td>Available</td>
</tr>
<tr>
<td>10.80.158.5</td>
<td>packetfeathersbastion</td>
</tr>
<tr>
<td>10.80.158.6</td>
<td>bootstrap.ocp4</td>
</tr>
<tr>
<td>10.80.158.7</td>
<td>master0.ocp4</td>
</tr>
<tr>
<td>10.80.158.8</td>
<td>master1.ocp4</td>
</tr>
<tr>
<td>10.80.158.9</td>
<td>master2.ocp4</td>
</tr>
<tr>
<td>10.80.158.10</td>
<td>worker0.ocp4</td>
</tr>
<tr>
<td>10.80.158.11</td>
<td>worker1.ocp4</td>
</tr>
<tr>
<td>10.80.158.12</td>
<td>worker2.ocp4</td>
</tr>
<tr>
<td>10.80.158.13</td>
<td>Available</td>
</tr>
<tr>
<td>10.80.158.14</td>
<td>Available</td>
</tr>
<tr>
<td>10.80.158.15</td>
<td>Broadcast</td>
</tr>
</tbody>
</table>
<h1 id="setup-bastioninstaller-server">Setup Bastion/Installer server</h1>
<h2 id="setup-dhcp">Setup DHCP</h2>
<p>First, create a backup of the default file (in case you make a mess) and then go ahead and amend the default file <code>/etc/dhcp/dhcpd.conf</code> with something like the below example. I crafted the below example actually using the shipped example file <code>/usr/share/doc/dhcp-server/dhcpd.conf.example</code>. It&rsquo;s fairly straight forward, just set the relevant network configuration and range of IP addresses you want to use, in my case I set that to be the four IP adddresses 10.80.158.11 - 10.80.158.14 (this is a very small range but good enough for what we&rsquo;re doing to test this process).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">sudo yum -y install dhcp-server
sudo cp /etc/dhcp/dhcpd.conf /etc/dhcp/dhcpd.conf.vanilla
sudo cp /usr/share/doc/dhcp-server/dhcpd.conf.example /etc/dhcp/dhcpd.conf
sudo vim /etc/dhcp/dhcpd.conf
</code></pre></div><h4 id="etcdhcpdhcpdconf">/etc/dhcp/dhcpd.conf</h4>
<pre><code># dhcpd.conf

option domain-name &quot;jftest.com&quot;;
option domain-name-servers 10.80.158.5;

default-lease-time 600;
max-lease-time 7200;

ddns-update-style interim;

authoritative;

subnet 10.80.158.0 netmask 255.255.255.240 {
  range 10.80.158.11 10.80.158.14;
  option routers 10.80.158.1;
  option routers 10.5.5.1;
  option broadcast-address 10.80.158.15;
}
</code></pre><h3 id="start-dhcp">Start DHCP</h3>
<p>Add the relevant firewall rules then start the DHCP service. Bonus points if it starts straight away with no errors! If you do get errors, go back and check what you&rsquo;ve done.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">sudo firewall-cmd --add-service=dhcp --permanent
sudo firewall-cmd --reload
sudo systemctl enable dhcpd --now
</code></pre></div><p>Great, at this stage if you were to boot a VM with the ova it would pick up an IP address from DHCP and run with it. That might actually be enough for you if this is just a temporary environment where you don&rsquo;t care about static addresses, but if want to set dedicated IPs as mentioned we will have to put them into our ignition files.</p>
<h1 id="ignition">Ignition</h1>
<p>My previous article covered creating the ignition files, so again I will not cover this here. From now the prerequisites and creation of the ignition files should be done. The below file is what my master.ign file that was generated by the Openshift install tool looks like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;ignition&#34;</span>: {
    <span style="color:#f92672">&#34;config&#34;</span>: {
      <span style="color:#f92672">&#34;append&#34;</span>: [
        {
          <span style="color:#f92672">&#34;source&#34;</span>: <span style="color:#e6db74">&#34;https://api-int.ocp4.jftest.com:22623/config/master&#34;</span>,
          <span style="color:#f92672">&#34;verification&#34;</span>: {}
        }
      ]
    },
    <span style="color:#f92672">&#34;security&#34;</span>: {
      <span style="color:#f92672">&#34;tls&#34;</span>: {
        <span style="color:#f92672">&#34;certificateAuthorities&#34;</span>: [
          {
            <span style="color:#f92672">&#34;source&#34;</span>: <span style="color:#e6db74">&#34;data:text/plain;charset=utf-8;base64,LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURFRENDQWZpZ0F3SUJBZ0lJVmFMNjVXRGsvdEl3RFFZSktvWklodmNOQVFFTEJRQXdKakVTTUJBR0ExVUUKQ3hNSmIzQmxibk5vYVdaME1SQXdEZ1lEVlFRREV3ZHliMjkwTFdOaE1CNFhEVEl3TURZeE56RTBNVEkwTkZvWApEVE13TURZeE5URTBNVEkwTkZvd0pqRVNNQkFHQTFVRUN4TUpiM0JsYm5Ob2FXWjBNUkF3RGdZRFZRUURFd2R5CmIyOTBMV05oTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUF2a1J4UjlNcm0wRlMKWjdDbnNkdmswOFllaTJoOGlMMWRyejBldzhMNUp0b0F2MzEzM2J4T1ZUcW96aWtMQlUvVUM3b1I4ejVncGFBYgpEOThCdGY5S2FKQ2kyRHRxYjJmQU9KV042L1NYaC9EUjR5T0pyVjY1V1NIKzZyMlJwOVo1b0FlY2IrUXdybEFCCnh3SHVEbVovdDA0Rm5zVktzK3VMQzZ5SitiTU81Y2c2ek55cmlCblkvY2pZd2NEekZNNkowSnJ2VG54VlpCT0YKM0RiOE1XQU02bEIvUjYrTzBKcktuWU1xZXdzYTBwMVpoSVNZMVBCN3RvQTMxS2NaREh2QTZMVW9jTGduQUYwago1Ylk4cVJITHQrcnNrdkJ0dHhMdzlDbVRLTVl6eDZaVlFtTDVjRjVlSCtkVXpNSVhuaHNpdVZnRmJPRXpDbWlRCjBnc29FQXlVU1FJREFRQUJvMEl3UURBT0JnTlZIUThCQWY4RUJBTUNBcVF3RHdZRFZSMFRBUUgvQkFVd0F3RUIKL3pBZEJnTlXIUTRFRmdRVVY3L0tEK3o2TmRQZCs2azNNUVRnWEF1dnVTUXdEUVlKS29aSWh2Y05BUUVMQlFBRApnZ0VCQUs0a3BRTHlleGdWOHBNVAJZZ04xVlpnY25Mb2tOZFhDdG8vTGZ4UldqRElDc1lLWkt3azVZVUg3eTVaCm4wV2svTG9wcFJlNkdCUnpEVStCS3daUEZpZWM0V1FqZnowcWdUZ0tOOVBiNzVVY1hZSjA5RVJQR3N1Ymo5aWoKVlE2VGxPb3lVYnhiWjFsamo4MW1aVmpPc3BQbFhySEF4amwvNjRNckpDRWYzbFRrSnJnZ3p5d2RvTmVmOGo0ZQpmOFZSaFlUQklLQVlLSlorMnZzZkRmejRRT1NRTXFhVUtIRHB5UUthc01zQ3dCSFBjRmZYWUgzTUFVenFTdE90CnYwRHFyMjdkVmRsOU1QZlJXRHkrK3g2Nk80Y2llUE9rbzY1OVo2U3J1TWZrQXkwMGZOcjZYK09JMEpaTnI3QzUKSTUyUHBFRTdhMmVEdGxDa2NsUkhYT3ZaR3ZRPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==&#34;</span>,
            <span style="color:#f92672">&#34;verification&#34;</span>: {}
          }
        ]
      }
    },
    <span style="color:#f92672">&#34;timeouts&#34;</span>: {},
    <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;2.2.0&#34;</span>
  },
  <span style="color:#f92672">&#34;networkd&#34;</span>: {},
  <span style="color:#f92672">&#34;passwd&#34;</span>: {},
  <span style="color:#f92672">&#34;storage&#34;</span>: {},
  <span style="color:#f92672">&#34;systemd&#34;</span>: {}
}
</code></pre></div><h4 id="fyi">FYI</h4>
<p>To encode and decode a string you can use the <code>base64</code> command, e.g.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">echo &#39;james&#39; | base64 -w0
echo &#39;amFtZXMK&#39; | base64 -d
</code></pre></div><p>This will come in handy.</p>
<h3 id="creating-new-modified-ignition-files">Creating new modified Ignition files</h3>
<p>What we will do here is create a separate ignition file for each node, so for all teh master nodes create a copy of the masters ignition and the same for the workers, for the bootstrap you wil have to create the one ammend-botstrap ignition file. For us to add the network configuration, we can break it down into 2 additional sections that we need to add.</p>
<ol>
<li><strong>Network</strong></li>
</ol>
<p>The first section is in the <code>networkd</code> part, we&rsquo;re adding the IP address, Gateway, DNS and Domain like so:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">  <span style="color:#e6db74">&#34;networkd&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
    <span style="color:#f92672">&#34;units&#34;</span>: [
      {
        <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;00-ens192.network&#34;</span>,
        <span style="color:#f92672">&#34;contents&#34;</span>: <span style="color:#e6db74">&#34;[Match]\nName=ens192\n\n[Network]\nAddress=.10.80.158.7/28\nGateway=10.80.158.1\nDNS=10.80.158.5\nDomains=jftest.com\n&#34;</span>
      }
    ]
  }<span style="color:#960050;background-color:#1e0010">,</span>
</code></pre></div><ol start="2">
<li><strong>Storage</strong></li>
</ol>
<p>The second section is in the <code>storage</code> part where we are defineing two files to be created. The first file is the <code>/etc/hostname</code> file, in which we are setting it&rsquo;s contents to <code>master0.ocp4.jftest.com</code>. The second file is the Interface configuration (ifcfg) file where we are adding network configuration.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">  <span style="color:#e6db74">&#34;storage&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
    <span style="color:#f92672">&#34;files&#34;</span>: [
      {
        <span style="color:#f92672">&#34;path&#34;</span>: <span style="color:#e6db74">&#34;/etc/hostname&#34;</span>,
        <span style="color:#f92672">&#34;mode&#34;</span>: <span style="color:#ae81ff">420</span>,
        <span style="color:#f92672">&#34;contents&#34;</span>: {
          <span style="color:#f92672">&#34;source&#34;</span>: <span style="color:#e6db74">&#34;data:text/plain;charset=utf-8;base64,bWFzdGVyMC5vY3A0LmpmdGVzdC5jb20=&#34;</span>,
          <span style="color:#f92672">&#34;verification&#34;</span>: {}
        },
        <span style="color:#f92672">&#34;filesystem&#34;</span>: <span style="color:#e6db74">&#34;root&#34;</span>
      },
      {
        <span style="color:#f92672">&#34;path&#34;</span>: <span style="color:#e6db74">&#34;/etc/sysconfig/network-scripts/ifcfg-ens192&#34;</span>,
        <span style="color:#f92672">&#34;mode&#34;</span>: <span style="color:#ae81ff">420</span>,
        <span style="color:#f92672">&#34;contents&#34;</span>: {
          <span style="color:#f92672">&#34;source&#34;</span>: <span style="color:#e6db74">&#34;data:text/plain;charset=utf-8;base64,IyBHZW5lcmF0ZWQgYnkgY3JlYXRlaWducyAKVFlQRT1FdGhlcm5ldApOQU1FPSJlbnMxOTIiCkRFVklDRT0iZW5zMTkyIgpPTkJPT1Q9eWVzCk5FVEJPT1Q9eWVzCkJPT1RQUk9UTz1ub25lCklQQUREUj0iMTAuODAuMTU4LjciCk5FVE1BU0s9IjI1NS4yNTUuMjU1LjI0MCIKR0FURVdBWT0iMTAuODAuMTU4LjEiCkROUzE9IjEwLjgwLjE1OC41Ig==Cg==&#34;</span>,
          <span style="color:#f92672">&#34;verification&#34;</span>: {}
        },
        <span style="color:#f92672">&#34;filesystem&#34;</span>: <span style="color:#e6db74">&#34;root&#34;</span>
      }
    ]
  }<span style="color:#960050;background-color:#1e0010">,</span>

</code></pre></div><p>The below is the ifcfg file I created which as mentioned above was converted into a base64 string and added into the ignition file:</p>
<pre><code># Generated by createigns
TYPE=Ethernet
NAME=&quot;ens192&quot;
DEVICE=&quot;ens192&quot;
ONBOOT=yes
NETBOOT=yes
BOOTPROTO=none
IPADDR=&quot;10.80.158.7&quot;
NETMASK=&quot;255.255.255.240&quot;
GATEWAY=&quot;10.80.158.1&quot;
DNS1=&quot;10.80.158.5&quot;
</code></pre><p>The reason that we are base64 encoding these values are that there a limit on the size of the config which may be provided to a machine. Therefore, base64 encoding them works around this. We could probably get away with having the hostname in cleartext like shown in the CoreOS documentation like the example below&hellip; but to be on the safe side, probably better to encode it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#e6db74">&#34;storage&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
   <span style="color:#f92672">&#34;files&#34;</span>: [
  {
     <span style="color:#f92672">&#34;filesystem&#34;</span>: <span style="color:#e6db74">&#34;root&#34;</span>,
     <span style="color:#f92672">&#34;path&#34;</span>: <span style="color:#e6db74">&#34;/etc/hostname&#34;</span>,
     <span style="color:#f92672">&#34;mode&#34;</span>: <span style="color:#ae81ff">420</span>,
     <span style="color:#f92672">&#34;contents&#34;</span>: { <span style="color:#f92672">&#34;source&#34;</span>: <span style="color:#e6db74">&#34;data:,master0&#34;</span> }
   }
 ]
 }
</code></pre></div><h4 id="post-modification">Post Modification</h4>
<p>Postmodification each file will look similar to the example below:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;ignition&#34;</span>: {
    <span style="color:#f92672">&#34;config&#34;</span>: {
      <span style="color:#f92672">&#34;append&#34;</span>: [
        {
          <span style="color:#f92672">&#34;source&#34;</span>: <span style="color:#e6db74">&#34;https://api-int.ocp4.jftest.com:22623/config/master&#34;</span>,
          <span style="color:#f92672">&#34;verification&#34;</span>: {}
        }
      ]
    },
    <span style="color:#f92672">&#34;security&#34;</span>: {
      <span style="color:#f92672">&#34;tls&#34;</span>: {
        <span style="color:#f92672">&#34;certificateAuthorities&#34;</span>: [
          {
            <span style="color:#f92672">&#34;source&#34;</span>: <span style="color:#e6db74">&#34;data:text/plain;charset=utf-8;base64,LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURFRENDQWZpZ0F3SUJBZ0lJVmFMNjVXRGsvdEl3RFFZSktvWklodmNOQVFFTEJRQXdKakVTTUJBR0ExVUUKQ3hNSmIzQmxibk5vYVdaME1SQXdEZ1lEVlFRREV3ZHliMjkwTFdOaE1CNFhEVEl3TURZeE56RTBNVEkwTkZvWApEVE13TURZeE5URTBNVEkwTkZvd0pqRVNNQkFHQTFVRUN4TUpiM0JsYm5Ob2FXWjBNUkF3RGdZRFZRUURFd2R5CmIyOTBMV05oTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUF2a1J4UjlNcm0wRlMKWjdDbnNkdmswOFllaTJoOGlMMWRyejBldzhMNUp0b0F2MzEzM2J4T1ZUcW96aWtMQlUvVUM3b1I4ejVncGFBYgpEOThCdGY5S2FKQ2kyRHRxYjJmQU9KV042L1NYaC9EUjR5T0pyVjY1V1NIKzZyMlJwOVo1b0FlY2IrUXdybEFCCnh3SHVEbVovdDA0Rm5zVktzK3VMQzZ5SitiTU81Y2c2ek55cmlCblkvY2pZd2NEekZNNkowSnJ2VG54VlpCT0YKM0RiOE1XQU02bEIvUjYrTzBKcktuWU1xZXdzYTBwMVpoSVNZMVBCN3RvQTMxS2NaREh2QTZMVW9jTGduQUYwago1Ylk4cVJITHQrcnNrdkJ0dHhMdzlDbVRLTVl6eDZaVlFtTDVjRjVlSCtkVXpNSVhuaHNpdVZnRmJPRXpDbWlRCjBnc29FQXlVU1FJREFRQUJvMEl3UURBT0JnTlZIUThCQWY4RUJBTUNBcVF3RHdZRFZSMFRBUUgvQkFVd0F3RUIKL3pBZEJnTlXIUTRFRmdRVVY3L0tEK3o2TmRQZCs2azNNUVRnWEF1dnVTUXdEUVlKS29aSWh2Y05BUUVMQlFBRApnZ0VCQUs0a3BRTHlleGdWOHBNVAJZZ04xVlpnY25Mb2tOZFhDdG8vTGZ4UldqRElDc1lLWkt3azVZVUg3eTVaCm4wV2svTG9wcFJlNkdCUnpEVStCS3daUEZpZWM0V1FqZnowcWdUZ0tOOVBiNzVVY1hZSjA5RVJQR3N1Ymo5aWoKVlE2VGxPb3lVYnhiWjFsamo4MW1aVmpPc3BQbFhySEF4amwvNjRNckpDRWYzbFRrSnJnZ3p5d2RvTmVmOGo0ZQpmOFZSaFlUQklLQVlLSlorMnZzZkRmejRRT1NRTXFhVUtIRHB5UUthc01zQ3dCSFBjRmZYWUgzTUFVenFTdE90CnYwRHFyMjdkVmRsOU1QZlJXRHkrK3g2Nk80Y2llUE9rbzY1OVo2U3J1TWZrQXkwMGZOcjZYK09JMEpaTnI3QzUKSTUyUHBFRTdhMmVEdGxDa2NsUkhYT3ZaR3ZRPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==&#34;</span>,
            <span style="color:#f92672">&#34;verification&#34;</span>: {}
          }
        ]
      }
    },
    <span style="color:#f92672">&#34;timeouts&#34;</span>: {},
    <span style="color:#f92672">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;2.2.0&#34;</span>
  },
  <span style="color:#f92672">&#34;networkd&#34;</span>: {
    <span style="color:#f92672">&#34;units&#34;</span>: [
      {
        <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;00-ens192.network&#34;</span>,
        <span style="color:#f92672">&#34;contents&#34;</span>: <span style="color:#e6db74">&#34;[Match]\nName=ens192\n\n[Network]\nAddress=.10.80.158.7/28\nGateway=10.80.158.1\nDNS=10.80.158.5\nDomains=jftest.com\n&#34;</span>
      }
    ]
  },
  <span style="color:#f92672">&#34;passwd&#34;</span>: {},
  <span style="color:#f92672">&#34;storage&#34;</span>: {
    <span style="color:#f92672">&#34;files&#34;</span>: [
      {
        <span style="color:#f92672">&#34;path&#34;</span>: <span style="color:#e6db74">&#34;/etc/hostname&#34;</span>,
        <span style="color:#f92672">&#34;mode&#34;</span>: <span style="color:#ae81ff">420</span>,
        <span style="color:#f92672">&#34;contents&#34;</span>: {
          <span style="color:#f92672">&#34;source&#34;</span>: <span style="color:#e6db74">&#34;data:text/plain;charset=utf-8;base64,bWFzdGVyMC5vY3A0LmpmdGVzdC5jb20=&#34;</span>,
          <span style="color:#f92672">&#34;verification&#34;</span>: {}
        },
        <span style="color:#f92672">&#34;filesystem&#34;</span>: <span style="color:#e6db74">&#34;root&#34;</span>
      },
      {
        <span style="color:#f92672">&#34;path&#34;</span>: <span style="color:#e6db74">&#34;/etc/sysconfig/network-scripts/ifcfg-ens192&#34;</span>,
        <span style="color:#f92672">&#34;mode&#34;</span>: <span style="color:#ae81ff">420</span>,
        <span style="color:#f92672">&#34;contents&#34;</span>: {
          <span style="color:#f92672">&#34;source&#34;</span>: <span style="color:#e6db74">&#34;data:text/plain;charset=utf-8;base64,IyBHZW5lcmF0ZWQgYnkgY3JlYXRlaWducyAKVFlQRT1FdGhlcm5ldApOQU1FPSJlbnMxOTIiCkRFVklDRT0iZW5zMTkyIgpPTkJPT1Q9eWVzCk5FVEJPT1Q9eWVzCkJPT1RQUk9UTz1ub25lCklQQUREUj0iMTAuODAuMTU4LjciCk5FVE1BU0s9IjI1NS4yNTUuMjU1LjI0MCIKR0FURVdBWT0iMTAuODAuMTU4LjEiCkROUzE9IjEwLjgwLjE1OC41Ig==&#34;</span>,
          <span style="color:#f92672">&#34;verification&#34;</span>: {}
        },
        <span style="color:#f92672">&#34;filesystem&#34;</span>: <span style="color:#e6db74">&#34;root&#34;</span>
      }
    ]
  },
  <span style="color:#f92672">&#34;systemd&#34;</span>: {}
}
</code></pre></div><p>You can validate your ignition files created online here: <a href="https://coreos.com/validate/">https://coreos.com/validate/</a> (which is worth doing).</p>
<p>You can then create the base64 encoded version of the ignition files, like so:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">base64 -w0 ~/ocp4/master0.ocp4.jftest.com.ign &gt; ~/ocp4/master0.ocp4.jftest.com.64
</code></pre></div><p>The base64 encoded strings can then be used when you create the VM in ESXi. It will first boot the VM with a temporary DHCP assigned IP whilst it comes up, then once it&rsquo;s up it will set the static IP configuration. You will see the IP address in the console when the VM is up.</p>
<h1 id="openshift-install-process">Openshift Install Process</h1>
<h2 id="create-vms">Create VMs</h2>
<p>If you are creating the VMs using the ESXi web management console create the VMs using the ova template and then when prompted import the base64 ignition file for that specific VM. Nothing more should be required at this stage other than to power it on and wait. The bootstrap process will start and that&rsquo;s basically the start of the end of the install, mainly just waiting around at this stage, so feel free to make a brew or whatever.</p>
<p>If you are feeling like you&rsquo;d like to provsion the VM&rsquo;s in a better more automated way, you every much can! I was able to use the below ansible playbook to do just that and it worked gloriously.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">---
- <span style="color:#66d9ef">name</span>: Create VMs
  <span style="color:#66d9ef">hosts</span>: localhost
  <span style="color:#66d9ef">tasks</span>:

  - <span style="color:#66d9ef">name</span>: Provision VM using OVA
    <span style="color:#66d9ef">vmware_deploy_ovf</span>:
      <span style="color:#66d9ef">hostname</span>: <span style="color:#e6db74">&#39;139.178.72.66&#39;</span>
      <span style="color:#66d9ef">username</span>: <span style="color:#e6db74">&#39;root&#39;</span>
      <span style="color:#66d9ef">password</span>: <span style="color:#e6db74">&#39;n4{D2^U5Gg&#39;</span>
      <span style="color:#66d9ef">datacenter</span>: ha-datacenter
      <span style="color:#66d9ef">datastore</span>: datastore1
      <span style="color:#66d9ef">validate_certs</span>: no
      <span style="color:#66d9ef">ovf</span>: /home/james/rhcos<span style="color:#ae81ff">-4.4.3</span>-x86_64-vmware.x86_64.ova
      <span style="color:#66d9ef">name</span>: bootstrap.ocp4.jftest.com
      <span style="color:#66d9ef">power_on</span>: no
      <span style="color:#66d9ef">inject_ovf_env</span>: <span style="color:#66d9ef">true</span>
      <span style="color:#66d9ef">properties</span>:
        <span style="color:#66d9ef">guestinfo.ignition.config.data.encoding</span>: <span style="color:#e6db74">&#34;base64&#34;</span>
        <span style="color:#66d9ef">guestinfo.ignition.config.data</span>: <span style="color:#e6db74">&#34;ewogICJpZ25pdGlvbiI6IHsKICAgICJjb25maWciOiB7CiAgICAgICJhcHBlbmQiOiBbCiAgICAgICAgewogICAgICAgICAgInNvdXJjZSI6ICJodHRwOi8vMTAuODAuMTU4LjU6ODA4MC9ib290c3RyYXAuaWduIiwKICAgICAgICAgICJ2ZXJpZmljYXRpb24iOiB7fQogICAgICAgIH0KICAgICAgXQogICAgfSwKICAgICJ0aW1lb3V0cyI6IHt9LAogICAgInZlcnNpb24iOiAiMi4xLjAiCiAgfSwKICAibmV0d29ya2QiOiB7CiAgICAidW5pdHMiOiBbCiAgICAgIHsKICAgICAgICAibmFtZSI6ICIwMC1lbnMxOTIubmV0d29yayIsCiAgICAgICAgImNvbnRlbnRzIjogIltNYXRjaF1cbk5hbWU9ZW5zMTkyXG5cbltOZXR3b3JrXVxuQWRkcmVzcz0uMTAuODAuMTU4LjYvMjhcbkdhdGV3YXk9MTAuODAuMTU4LjFcbkROUz0xMC44MC4xNTguNVxuRG9tYWlucz1qZnRlc3QuY29tXG4iCiAgICAgIH0KICAgIF0KICB9LAogICJwYXNzd2QiOiB7fSwKICAic3RvcmFnZSI6IHsKICAgICJmaWxlcyI6IFsKICAgICAgewogIAAgICAgICJwYXRoIjogIi9ldGMvaG9zdG5hbWUiLAogICAgICAgICJtb2RlIjogNDIwLAogICAgICAgICJjb250ZW50cyI6IHsKICAgICAgICAgICJzb3VyY2UiOiAiZGF0YTp0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLTg7YmFzZTY0LFltOXZkSE4wY21Gd0xtOWpjRFF1YW1aMFpYTjBMbU52YlE9PSIsCiAgICAgICAgICAidmVyaWZpY2F0aW9uIjoge30KICAgICAgICB9LAogICAgICAgICJmaWxlc3lzdGVtIjogInJvb3QiCiAgICAgIH0sCiAgICAgIHsKICAgICAgICAicGF0aCI6ICIvZXRjL3N5c2NvbmZpZy9uZXR3b3JrLXNjcmlwdHMvaWZjZmctZW5zMTkyIiwKICAgICAgICAibW9kZSI6IDQyMCwKICAgICAgICAiY29udGVudHMiOiB7CiAgICAgICAgICAic291cmNlIjogImRhdGE6dGV4dC9wbGFpbjtjaGFyc2V0PXV0Zi04O2Jhc2U2NCxJeUJIWlc1bGNtRjBaV1FnWW5rZ1kzSmxZWFJsYVdkdWN5QUtWRmxRUlQxRmRHaGxjbTVsZEFwT1FVMUZQU0psYm5NeE9USWlDa1JGVmtsRFJUMGlaVzV6TVRreUlncFBUa0pQVDFROWVXVnpDazVGVkVKUFQxUTllV1Z6Q2tKUFQxUlFVazlVVHoxdWIyNWxDa2xRUVVSRVVqMGlNVEF1T0RBdU1UVTRMallpQ2s1RlZFMUJVMHM5SWpJMU5TNHlOVFV1TWpVMUxqSTBNQ0lLUjBGVVJWZEJXVDBpTVRBdU9EQXVNVFU0TGpFaUNrUk9VekU5SWpFd0xqZ3dMakUxT0M0MUlnPT0iLAogICAgICAgICAgInZlcmlmaWNhdGlvbiI6IHt9CiAgICAgICAgfSwKICAgICAgICAiZmlsZXN5c3RlbSI6ICJyb290IgogICAgICB9CiAgICBdCiAgfSwKICAic3lzdGVtZCI6IHt9Cn0=&#34;</span>
    <span style="color:#66d9ef">delegate_to</span>: localhost

  - <span style="color:#66d9ef">name</span>: Reconfigure CPU, RAM and HDD size of VM
    <span style="color:#66d9ef">vmware_guest</span>:
      <span style="color:#66d9ef">hostname</span>: <span style="color:#e6db74">&#39;139.178.72.66&#39;</span>
      <span style="color:#66d9ef">username</span>: <span style="color:#e6db74">&#39;root&#39;</span>
      <span style="color:#66d9ef">password</span>: <span style="color:#e6db74">&#39;n4{D2^U5Gg&#39;</span>
      <span style="color:#66d9ef">datacenter</span>: ha-datacenter
      <span style="color:#66d9ef">datastore</span>: datastore1
      <span style="color:#66d9ef">name</span>: bootstrap.ocp4.jftest.com
      <span style="color:#66d9ef">state</span>: <span style="color:#e6db74">&#34;present&#34;</span>
      <span style="color:#66d9ef">validate_certs</span>: <span style="color:#e6db74">&#34;false&#34;</span>
      <span style="color:#66d9ef">hardware</span>:
        <span style="color:#66d9ef">memory_mb</span>: <span style="color:#e6db74">&#34;16384&#34;</span>
        <span style="color:#66d9ef">num_cpus</span>: <span style="color:#e6db74">&#34;4&#34;</span>
      <span style="color:#66d9ef">disk</span>:
        - <span style="color:#66d9ef">size_gb</span>: <span style="color:#ae81ff">60</span>
          <span style="color:#66d9ef">type</span>: thin
    <span style="color:#66d9ef">delegate_to</span>: <span style="color:#e6db74">&#34;localhost&#34;</span>
</code></pre></div><p>I won&rsquo;t cover the last steps of bringing up the cluster and approving the workers certs etc as the previous article covers all that (the process is similar if not the same at this stage anyway).</p>
<h1 id="summary">Summary</h1>
<p>I like this process a bit more than the last one, however, a DHCPD instance is required and you have to be careful adding DHCP into an environment that doesn&rsquo;t have one. Special thanks to Alejandro for the inspiration for this process! (see references at the bottom).</p>
<p>I&rsquo;ve put together a role to create a set of base64 encoded ignition files. This might be useful to quickly generate all necessary ignitions <a href="https://github.com/james-cccc/createigns">https://github.com/james-cccc/createigns</a> - I do plan on working this further to not only generate the modified ignitions but also do the provisioning maybe using the <code>vmware_deploy_ovf</code> module.</p>
<h1 id="references">References</h1>
<p>The below documentation and articles helped me put all this together.</p>
<ol>
<li><a href="https://www.openshift.com/blog/how-to-install-openshift-on-vmware-with-terraform-and-static-ip-addresses">https://www.openshift.com/blog/how-to-install-openshift-on-vmware-with-terraform-and-static-ip-addresses</a></li>
<li><a href="https://coreos.com/ignition/docs/latest/examples.html">https://coreos.com/ignition/docs/latest/examples.html</a></li>
<li><a href="https://coreos.com/ignition/docs/latest/network-configuration.html">https://coreos.com/ignition/docs/latest/network-configuration.html</a></li>
<li><a href="https://docs.ansible.com/ansible/latest/modules/vmware_deploy_ovf_module.html">https://docs.ansible.com/ansible/latest/modules/vmware_deploy_ovf_module.html</a></li>
<li><a href="https://docs.ansible.com/ansible/latest/modules/vmware_guest_module.html">https://docs.ansible.com/ansible/latest/modules/vmware_guest_module.html</a></li>
</ol>

                    
                    <HR width="100%" id="EOF">
                    <p style="color:#777;">Last modified on 22-06-2020</p>
                    
                </div>
            </div>




            <div class="post-comment-wrapper">
                
                <p style="opacity: 0.6" align="center">
                    <small> </small>
                </p>
                
            </div>
        </div>
    </div>
</div>

            </div><div id="single-column-footer"></div>
            </div>
    <script>
let app;

app = new Vue({
    el: '#app',
    data: {
        scrollY: 0,
        navOpacity: 0,
        isDrawerOpen: false,
        mounted: false,
        isDarkMode: false
    },
    methods: {
            sgn(t, x) {
                let k = 1. / (1. - 2 * t);
                if (x <= t) return 0;
                else if (x >= 1 - t) return 1;
                else {
                    return k * (x - t);
                }
            },
            handleScroll() {
                this.scrollY = window.scrollY;
                this.navOpacity = this.sgn(.0, Math.min(1, Math.max(0, window.scrollY / (this.pageHeadHeight() - this.navBarHeight() * 0.8))));
                const {navBar, navBackground, navTitle, extraContainer, streamContainer} = this.$refs;

                if (this.navOpacity >= 1) {
                    navBackground.style.opacity = 1;
                    navTitle.style.opacity = 1;
                } else {
                    navBackground.style.opacity = 0;
                    navTitle.style.opacity = 0;
                }
            },
            handleResize() {
                const {navBar, navBackground, navTitle, extraContainer, streamContainer} = this.$refs;
                extraContainer.style.left = (streamContainer.offsetWidth - extraContainer.offsetWidth) + 'px';
            },
            navBarHeight() {
                return this.$refs.navBar.offsetHeight;
            },
            pageHeadHeight() {
                return this.$refs.pageHead.offsetHeight;
            },
            toggleDrawer() {
                this.isDrawerOpen = !this.isDrawerOpen;
                document.getElementsByTagName('html')[0].style.overflow = this.isDrawerOpen ? 'hidden' : 'unset';
            },
            closeDrawer() {
                this.isDrawerOpen = false;
                document.getElementsByTagName('html')[0].style.overflow = this.isDrawerOpen ? 'hidden' : 'unset';
            },
            toggleDarkMode() {
                this.isDarkMode = !this.isDarkMode;
                if (this.isDarkMode==true){
                    document.cookie = "night=1;path=/";
                    document.body.classList.add("night");
                } else {
                    document.cookie = "night=0;path=/";
                    document.body.classList.remove("night");
                }
            }
    },
    created() {
        window.addEventListener('scroll', this.handleScroll);
        window.addEventListener('resize', this.handleResize);
        window._nonDesktop = function () {
            let check = false;
            (function (a) {
                if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4))) check = true;
            })(navigator.userAgent || navigator.vendor || window.opera);
            return check;
        };
        
        var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1");
        if (night==""){
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                
            }
        }else{
            
            if (night=="1") {
                this.toggleDarkMode();
            }
        }
    },
    mounted() {
        this.handleScroll();
        this.handleResize();
        this.mounted = true;
        
    },
    destroyed() {
        window.removeEventListener('scroll', this.handleScroll);
        window.removeEventListener('resize', this.handleResize);
    }
});
</script>

<script src="https://sysadm.life/js/journal.js"></script>
    </body>
</html>
